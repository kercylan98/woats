# 📖 前言
> 大概在2020年7月开始正式接触到学校课程编排相关的内容，期间也进行了各种模型的设计，但是都不太尽人意。这一次的尝试相对来说比之前的更为满意一些。

> EMAIL：kercylan@gmail.com

> 所有内容均未经过严格测试，仅属于个人尝试。
### 💡 一些特殊的点
> 这些想法大部分来自各个不同的学校以及开发过程中对其理解的扩展。

### 🧩 自由组合的排课算法
> 以往的尝试中发现使用某种特定的排课算法来作为排课核心后，会导致一系列扩展困难、新规则难兼容、代码愈来愈复杂等问题。
> 
> 比如在第一次尝试的时候采用了`回滚重排`的方法来解决冲突，而当后面我想加入`遗传算法`进行尝试的时候根本无从下手。甚至面对一些简单的`尽量连堂`、`特定课位连堂`规则也很难再去满足。

> 这一次在设计上，将排课的流程进行了抽象，就像一个工作室一样。开始排课的时候，会把传入工作室的原材料（基础数据）交给事先准备好的流水线（一堆按照特定顺序传入的排课策略）进行处理，当流水线的某个环节无法解决问题的时候，交给下一个环节继续处理。

### 🕙 班级与班级之间支持不同的上课时间段
> 为了能够满足更自由的课程安排，满足班级与班级之间支持不同的上课时间段（上海华东师范大学附属双语学校中小学部提出，目前虽然仅仅是年级之间的上课时间段不同，但是未来也可能会发生细化至班级的情况），目前了解下来大多数的排课都是以`课节次`来进行冲突的校验的，少有的支持为年级设置`上课时间段`来进行时间段的冲突校验。
- ✅ 放弃使用之前尝试的二维数组来存储课位信息，采用新的数据结构：
  ```
  type ThreeDimensionalMatrix map[班级名次]map[课位号]wtype.FactorGroup
  ```
  > 新的数据结构使得课位是附着在没一个班级上的，这样课位只需要包含时间信息，便可以支持班级与班级之间不同的上课时间段；
  
  > 难点：由于时间段的不同，将二维课表变成了三维课表。可能与传统课表完全不同。在渲染的时候，Excel便无法很好的展示最终总课表，课表可能会以瀑布流的形式进行呈现，并且在两个班级之间的时间段交叉的时候，结果就会在Z轴上扩张；
  

- ✅ 采用包含时间信息的`时间课位`：
  > 放弃了原本还包含各种教学计划的复杂设计，采用了新的、仅包含必要信息的数据结构。将课位仅仅作为一个标记；
  
  > 课位实现了`检查两个课位时间是否交叉`以及`比较是否大于另一个时间段`的功能；
  ```
  type TimeSlot struct {
	    UniqueSign string
	    Index      int     // 课位号
	    WhatDay    int     // 第几天
	    Start      float64 // 开始时间
	    End        float64 // 结束时间

	    StartHour   int
	    StartMinute int

	    EndHour   int
	    EndMinute int
  }
  ```

### 🍳 更简单易维护的数据录入
- ✅ 更简单且易于扩展的的基础数据录入数据结构
  > 将所有的年级、班级、学生、教师、教学场地等数据均看作为普通的字符串（UniqueSign），解决了各种数据之间的复杂关系嵌套（学生属于哪个班级，班级有哪些学生等）问题，所有关系都在创建数据的时候进行描述。最后将`行政班`和`选修班`转换为排课因子进行排课。
  > 
  > 排课，仅仅只排课（很多次排课尝试由于数据结构的复杂设计浪费大量时间，并且造成扩展困难、重构影响大等问题）； 
  
  > 采用了修饰器链式构造的方式来建立参与排课的`行政班`和`选修班`数据，具体数据来源则可以根据实现不同的`Designer`来从数据库、第三方接口、本地等渠道获取；